<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Calculator - Unit Tests</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .test-result.pass {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .test-result.fail {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .summary {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 6px;
        }

        .test-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .test-details {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.8;
        }

        #runTests {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }

        #runTests:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Investment Calculator - Unit Tests</h1>
        <button id="runTests">Run Tests</button>
        <div id="results"></div>
    </div>

    <script>
        // Test calculator class (extracted logic from main file)
        class InvestmentCalculatorCore {
            calculateTotalCapital(monthlySavings, annualRate, years) {
                // Formula: FV = PMT × 12 × [(1 + r)^n - 1] / r
                // Where r = annual rate, n = years
                // PMT × 12 accounts for 12 monthly contributions per year

                if (annualRate === 0) {
                    return monthlySavings * 12 * years;
                }

                return monthlySavings * 12 * (Math.pow(1 + annualRate, years) - 1) / annualRate;
            }

            calculateInvestmentData(monthlySavings, annualRate, maxYears = 30, initialCapital = 0) {
                const data = [];
                let startingCapital = initialCapital;
                let cumulativeInvested = initialCapital;

                for (let year = 1; year <= maxYears; year++) {
                    const annualDeposit = monthlySavings * 12;
                    const interestEarned = startingCapital * annualRate;
                    const endingCapital = startingCapital + annualDeposit + interestEarned;
                    cumulativeInvested += annualDeposit;
                    const monthlyIncome = endingCapital * annualRate / 12;

                    data.push({
                        year: year,
                        startingCapital: startingCapital,
                        annualDeposit: annualDeposit,
                        interestEarned: interestEarned,
                        endingCapital: endingCapital,
                        totalInvested: cumulativeInvested,
                        monthlyIncome: monthlyIncome
                    });

                    startingCapital = endingCapital;
                }

                return data;
            }
        }

        // Test framework
        class TestRunner {
            constructor() {
                this.tests = [];
                this.results = [];
            }

            test(name, fn) {
                this.tests.push({ name, fn });
            }

            assertEqual(actual, expected, message = '') {
                if (Math.abs(actual - expected) < 0.01) {
                    return { pass: true, message };
                } else {
                    return {
                        pass: false,
                        message: `${message}\nExpected: ${expected}, Got: ${actual}`
                    };
                }
            }

            assertArrayLength(arr, expectedLength, message = '') {
                if (arr.length === expectedLength) {
                    return { pass: true, message };
                } else {
                    return {
                        pass: false,
                        message: `${message}\nExpected length: ${expectedLength}, Got: ${arr.length}`
                    };
                }
            }

            assertTrue(value, message = '') {
                if (value === true) {
                    return { pass: true, message };
                } else {
                    return {
                        pass: false,
                        message: `${message}\nExpected: true, Got: ${value}`
                    };
                }
            }

            async runAll() {
                this.results = [];

                for (const test of this.tests) {
                    try {
                        const result = await test.fn();
                        this.results.push({
                            name: test.name,
                            pass: result.pass,
                            message: result.message
                        });
                    } catch (error) {
                        this.results.push({
                            name: test.name,
                            pass: false,
                            message: `Error: ${error.message}`
                        });
                    }
                }

                return this.results;
            }

            displayResults() {
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';

                const passed = this.results.filter(r => r.pass).length;
                const total = this.results.length;

                const summary = document.createElement('div');
                summary.className = 'summary';
                summary.textContent = `Tests: ${passed}/${total} passed`;
                resultsDiv.appendChild(summary);

                this.results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-result ${result.pass ? 'pass' : 'fail'}`;

                    const name = document.createElement('div');
                    name.className = 'test-name';
                    name.textContent = `${result.pass ? '✓' : '✗'} ${result.name}`;
                    div.appendChild(name);

                    if (result.message) {
                        const details = document.createElement('div');
                        details.className = 'test-details';
                        details.textContent = result.message;
                        div.appendChild(details);
                    }

                    resultsDiv.appendChild(div);
                });
            }
        }

        // Define tests
        const runner = new TestRunner();
        const calc = new InvestmentCalculatorCore();

        // Test based on provided example: Initial=100, Monthly=10, Rate=10%
        runner.test('Year 1: Starting=100, Deposit=120, Interest=10, Ending=230, Invested=220', () => {
            const data = calc.calculateInvestmentData(10, 0.10, 1, 100);
            const year1 = data[0];
            return runner.assertEqual(year1.startingCapital, 100) &&
                   runner.assertEqual(year1.annualDeposit, 120) &&
                   runner.assertEqual(year1.interestEarned, 10) &&
                   runner.assertEqual(year1.endingCapital, 230) &&
                   runner.assertEqual(year1.totalInvested, 220);
        });

        runner.test('Year 2: Starting=230, Deposit=120, Interest=23, Ending=373, Invested=340', () => {
            const data = calc.calculateInvestmentData(10, 0.10, 2, 100);
            const year2 = data[1];
            return runner.assertEqual(year2.startingCapital, 230) &&
                   runner.assertEqual(year2.annualDeposit, 120) &&
                   runner.assertEqual(year2.interestEarned, 23) &&
                   runner.assertEqual(year2.endingCapital, 373) &&
                   runner.assertEqual(year2.totalInvested, 340);
        });

        runner.test('Year 3: Starting=373, Deposit=120, Interest=37, Ending=530, Invested=460', () => {
            const data = calc.calculateInvestmentData(10, 0.10, 3, 100);
            const year3 = data[2];
            return runner.assertEqual(year3.startingCapital, 373) &&
                   runner.assertEqual(year3.annualDeposit, 120) &&
                   runner.assertEqual(year3.interestEarned, 37) &&
                   runner.assertEqual(year3.endingCapital, 530) &&
                   runner.assertEqual(year3.totalInvested, 460);
        });

        runner.test('Ending capital equals starting + deposit + interest', () => {
            const data = calc.calculateInvestmentData(10, 0.10, 1, 100);
            const year1 = data[0];
            const expected = year1.startingCapital + year1.annualDeposit + year1.interestEarned;
            return runner.assertEqual(year1.endingCapital, expected, 'Ending capital formula is correct');
        });

        runner.test('Investment data generates correct number of years', () => {
            const data = calc.calculateInvestmentData(300, 0.10, 30);
            return runner.assertArrayLength(data, 30, 'Should generate 30 data points');
        });

        runner.test('Investment data includes all required fields', () => {
            const data = calc.calculateInvestmentData(300, 0.10, 1);
            const hasAllFields = data[0].hasOwnProperty('year') &&
                                data[0].hasOwnProperty('startingCapital') &&
                                data[0].hasOwnProperty('annualDeposit') &&
                                data[0].hasOwnProperty('interestEarned') &&
                                data[0].hasOwnProperty('endingCapital') &&
                                data[0].hasOwnProperty('totalInvested') &&
                                data[0].hasOwnProperty('monthlyIncome');
            return runner.assertTrue(hasAllFields, 'Data should include all required fields');
        });

        runner.test('Interest earned equals starting capital × annual rate', () => {
            const data = calc.calculateInvestmentData(10, 0.10, 2, 100);
            const year2 = data[1];
            const expectedInterest = year2.startingCapital * 0.10;
            return runner.assertEqual(year2.interestEarned, expectedInterest, 'Interest calculation is correct');
        });

        runner.test('Monthly income equals (ending capital × annual rate) / 12', () => {
            const data = calc.calculateInvestmentData(10, 0.10, 1, 100);
            const year1 = data[0];
            const expectedMonthlyIncome = (year1.endingCapital * 0.10) / 12;
            return runner.assertEqual(year1.monthlyIncome, expectedMonthlyIncome, 'Monthly income calculation is correct');
        });

        runner.test('Capital grows over time with positive return', () => {
            const data = calc.calculateInvestmentData(300, 0.10, 10);
            const isGrowing = data[9].endingCapital > data[0].endingCapital;
            return runner.assertTrue(isGrowing, 'Capital should grow over time with positive returns');
        });

        runner.test('Zero monthly savings with no initial results in zero capital', () => {
            const data = calc.calculateInvestmentData(0, 0.10, 5, 0);
            return runner.assertEqual(data[4].endingCapital, 0, 'Zero savings should result in zero capital');
        });

        runner.test('Higher return rate produces higher capital', () => {
            const data10Percent = calc.calculateInvestmentData(300, 0.10, 10);
            const data5Percent = calc.calculateInvestmentData(300, 0.05, 10);
            const isHigher = data10Percent[9].endingCapital > data5Percent[9].endingCapital;
            return runner.assertTrue(isHigher, '10% return should produce more capital than 5% return');
        });

        runner.test('Total invested cumulates correctly over years', () => {
            const data = calc.calculateInvestmentData(100, 0.10, 3, 1000);
            // Year 1: 1000 + 1200 = 2200
            // Year 2: 2200 + 1200 = 3400
            // Year 3: 3400 + 1200 = 4600
            return runner.assertEqual(data[2].totalInvested, 4600, 'Total invested cumulates correctly');
        });

        runner.test('Initial capital generates interest in year 1', () => {
            const data = calc.calculateInvestmentData(100, 0.10, 1, 5000);
            const expectedInterest = 5000 * 0.10;
            return runner.assertEqual(data[0].interestEarned, expectedInterest, 'Initial capital should generate interest');
        });

        // Run tests button
        document.getElementById('runTests').addEventListener('click', async () => {
            document.getElementById('runTests').disabled = true;
            document.getElementById('runTests').textContent = 'Running tests...';

            await runner.runAll();
            runner.displayResults();

            document.getElementById('runTests').disabled = false;
            document.getElementById('runTests').textContent = 'Run Tests Again';
        });

        // Auto-run tests on load
        window.addEventListener('DOMContentLoaded', async () => {
            await runner.runAll();
            runner.displayResults();
            document.getElementById('runTests').textContent = 'Run Tests Again';
        });
    </script>
</body>
</html>
